<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="csrf-token" content="{{ csrf_token() }}">
		<meta name="description" content="KleenSpotless - Professional Cleaning Services">
		<meta name="keywords" content="cleaning, services, home cleaning, office cleaning, professional cleaning">
		<meta name="author" content="Divgm Technologies">
		<title>KleenSpotless - Professional Cleaning Services</title>
		<link rel="icon" href={{ url_for('static', filename='image/ks-favicon.png') }} type="image/x-icon">
		<link rel="stylesheet" href={{ url_for('static', filename='css/primary.css') }}>
		<link rel="stylesheet" href={{ url_for('static', filename='css/animation.css') }}>
		<script></script>
	</head>
	<body class="bg-gray-50 min-h-screen">
		<!-- Toast Container -->
		<div 
			id="toast-container" 
			 class="fixed top-4 left-1/2 -translate-x-1/2 z-50 
            w-full max-w-md px-4 space-y-3 pointer-events-none"></div>
		<!-- Hero Section -->
		<header class="container mx-auto px-4 py-12 max-w-6xl text-center">
			<div class="mb-12 animate-fade-in">
				<div class="flex justify-center items-center mb-6">
					<img 
					src={{ url_for('static', filename='image/square-logo-dark.png') }}
					alt="Square Logo" 
					class="h-16 w-auto object-contain"
					/>
				</div>
				<h1 class="text-2xl md:text-3xl font-semibold text-foreground mb-4 t">
					Secure Payment Processing
				</h1>
				<p class="text-xl text-muted-foreground max-w-2xl mx-auto">
					Fast, secure, and reliable payments powered by Square's industry-leading technology
				</p>
			</div>
		</header>
		<!-- Main Content -->
		<main class="container mx-auto px-4 max-w-6xl flex flex-col lg:flex-row gap-12 items-start justify-center">
			<!-- Payment Box -->
			<section class="w-full lg:w-auto">
				<div class="bg-gradient-card border border-card-border rounded-2xl p-8 shadow-card-custom w-full max-w-md mx-auto animate-scale-in">
					<!-- Security Notice -->
					<div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-6">
						<div class="flex items-center justify-center gap-2">
							<svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
								<path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
							</svg>
							<span class="text-xs md:text-sm font-medium text-green-800">
							Secured with 256-bit SSL encryption
							</span>
						</div>
					</div>
					<!-- Amount Display -->
					<div class="text-center mb-8">
						<div class="text-3xl font-bold text-primary mb-2">${{ booking_price }}</div>
						<div class="text-sm text-muted-foreground">CAD</div>
					</div>
					<!-- Payment Form -->
					<form id="payment-form" class="space-y-6" method="POST">
						<div class="space-y-6">
							<!-- Accordion -->
							<div class="border rounded-xl shadow-sm bg-white">
								<button type="button" 
									id="viewDetails"
									class="w-full flex items-center justify-between px-4 py-3 mb-3 text-left text-gray-700 font-medium hover:bg-gray-50 focus:outline-0 focus:border-rounded-lg"
									>
									<span>View Payment Details</span>
									<svg class="w-5 h-5 text-gray-500 transition-transform duration-300"
										id="accordion-icon"
										xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
										stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M19 9l-7 7-7-7" />
									</svg>
								</button>
							</div>
							
						</div>
						<div id="clientDetailsBox" class="hidden space-y-3">
							<div class="grid grid-cols-2 gap-4">
								<!-- firstName -->
								<div class="space-y-2">
									<label for="fileName" class="px-2 text-sm font-medium text-foreground text-gray-500">First Name</label>
									<input
										type="text"
										id="firstName"
										placeholder="{{ client.first_name}}"
										disabled
										class="w-full px-4 py-3 bg-white placeholder-gray-600
										placeholder-opacity-70 border border-border rounded-lg focus:ring-2 
										focus:ring-primary focus:border-transparent transition-all"
										/>
								</div>
								<!-- lastName -->
								<div class="space-y-2">
									<label for="lastName" class="text-sm font-medium text-foreground text-gray-500">Last Name</label>
									<input
										type="text"
										id="lastName"
										placeholder="{{ client.last_name }}"
										disabled
										class="w-full px-4 py-3 bg-white placeholder-gray-600
										placeholder-opacity-70 border border-border rounded-lg focus:ring-2 
										focus:ring-primary focus:border-transparent transition-all"
										/>
								</div>
							</div>
							<div class="grid grid-cols-2 gap-4">
								<!-- Email -->
								<div class="space-y-2">
									<label for="email" class="px-2 text-sm font-medium text-foreground text-gray-500">Email Address</label>
									<input
										type="email"
										id="email"
										placeholder="{{ client.email}}"
										disabled
										class="w-full px-4 py-3 bg-white border border-border rounded-lg 
										placeholder-gray-600 placeholder-opacity-70 focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
										/>
								</div>
								<!-- phoneNumber -->
								<div class="space-y-2">
									<label for="phoneNumber" class="text-sm font-medium text-foreground text-gray-500">Phone Number</label>
									<input
										type="text"
										id="phoneNumber"
										placeholder="{{ client.phone }}"
										disabled
										class="w-full px-4 py-3 bg-white border border-border rounded-lg 
										placeholder-text-gray-600 placeholder-opacity-70 focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
										/>
								</div>
							</div>
							<!-- Street -->
							<div id="clientBox" class="space-y-2 text-gray-500">
								<label for="address" class="px-2 text-sm font-medium text-foreground">Client Address</label>
								<input
									type="text"
									id="address"
									placeholder="{% if address %}{{ address.street }}{% else %}1234 Mentone Ave{% endif %}"
									class="w-full px-4 py-3 bg-white border border-border rounded-lg
									placeholder-text-gray-600 placeholder-opacity-70 focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
									disabled
									/>
							</div>
							<div class="grid grid-cols-2 gap-4 text-gray-500">
								<!-- city -->
								<div class="space-y-2">
									<label for="city" class="px-2 text-sm font-medium text-foreground">City</label>
									<input
										type="text"
										id="city"
										placeholder="{{ address.city }}"
										disabled
										class="w-full px-4 py-3 bg-white border border-border rounded-lg
										placeholder-text-gray-600 placeholder-opacity-70 focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
										/>
								</div>
								<!-- province -->
								<div class="space-y-2 text-gray-500">
									<label for="province" class="text-sm font-medium text-foreground">Province</label>
									<input
										type="text"
										id="province"
										placeholder="{{ address.state }}"
										disabled
										class="w-full px-4 py-3 bg-white border border-border rounded-lg
										placeholder-text-gray-600 placeholder-opacity-70 focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
										/>
								</div>
							</div>
						</div>

            <!-- Payment Instructions -->
							<div class="bg-white border rounded-xl p-4 shadow-sm">
								<h3 class="text-gray-700 font-semibold mb-2">Payment Instructions</h3>
								<ul class="list-disc list-outside ml-6 space-y-2 text-xs md:text-sm text-gray-500">
                  <li class="text-green-600">60% due to confirm booking, balance payable after cleaning on-site.</li>
									<li class="text-amber-600">Ensure your card details match your billing information.</li>
									<li class="text-red-600">Do not refresh or close this page while payment is processing.</li>
									<li class="text-amber-600">Use your Postal/Zip code for clients within USA/Canada</li>
                  <li class="text-green-500">You’ll receive a confirmation email once your payment is successful.</li>
								</ul>
							</div>
						<!-- Square Up card Modal -->
						<div id="card-container" class="space-y-2"></div>
						<!-- Pay Button -->
						<button 
						type="button" 
						id="card-pay-button"
						class="hidden w-full {% if is_paid %}bg-gray-500{% else %}bg-secondary{% endif %} text-white text-primary-foreground font-semibold py-4 rounded-lg shadow-payment hover:shadow-hover transition-all duration-300 transform hover:scale-[1.02] focus:ring-2 focus:ring-primary focus:ring-offset-2"
						{% if is_paid %}disabled{% endif %}
						>
						<span id="button-text" class="">
						{% if is_paid %}
						Already Paid
						{% else %}
						Pay ${{ charge_amount }} CAD
						{% endif %}
						</span>
						<span id="loading-spinner" class="hidden">
							<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
								<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
								<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
							</svg>
							Processing...
						</span>
						</button>
					</form>
					<!-- Security Badges -->
					<div class="mt-6 pt-6 border-t border-border text-gray-500">
						<div class="flex items-center justify-center gap-4 text-xs text-muted-foreground">
							<div class="flex items-center gap-1">
								<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
									<path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
								</svg>
								SSL Secured
							</div>
							<div class="flex items-center gap-1">
								<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
									<path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
								</svg>
								PCI Compliant
							</div>
						</div>
						<div class="text-center mt-2 text-xs text-muted-foreground">
							Powered by Square
						</div>
					</div>
				</div>
			</section>
			<div id="paymentComplete" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
				<div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center animate-fadeIn">
					<dotlottie-wc
						src="{{ url_for('static', filename='lottie/payment-successful.lottie') }}"
						class="w-full max-w-xs sm:max-w-sm md:w-[300px] md:h-[300px]"
						speed="0.5"
						autoplay
						></dotlottie-wc>
					<h2 class="text-2xl font-bold text-blue-900 mb-4">Thank you {{ client.first_name }}</h2>
					<p class="text-xs md:text-base text-blue-900 mb-6">Your payment receipt is on the way. Please check your mail, spam or junk folder.</p>
					<div class="bg-gray-50 rounded-lg p-4 mb-6">
						<p class="text-sm text-blue-900">Charged Amount</p>
						<p id="chargedAmount" class="text-2xl font-bold text-primary">$90</p>
					</div>
					<div class="bg-blue-50 rounded-lg p-4 mb-6">
						<p class="text-sm text-blue-900 pb-2 text-2l">Payment Overview:</p>
						<p id="" class="text-blue-800 text-sm pb-1">Booking ID: <span id="bookingID">KSH-175814094</span></p>
						<p class="text-blue-800 text-sm pb-1">REF: <span id="bookedService">REF-2312345014</span></p>
						<p id="confirmedSchedule" class="text-blue-800 text-sm pb-1">Visa - Debit Card</p>
					</div>
					<!--<button onclick="resetBooking()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-blue-950 transition-colors">
						Book Another Service
						</button> -->
					<span>P</span>
				</div>
			</div>
			<!-- Info Panel -->
			<aside class="w-full lg:w-96 animate-fade-in" style="animation-delay: 200ms">
				<div class="bg-white border border-card-border rounded-2xl p-6 mb-10">
					<h3 class="text-lg font-semibold text-foreground mb-4">
						Why Choose square
					</h3>
					<ul class="space-y-3 text-sm text-muted-foreground">
						<li class="flex items-center gap-2">
							<div class="w-2 h-2 bg-green-400 rounded-full shrink-0"></div>
							Industry-leading security standards
						</li>
						<li class="flex items-center gap-2">
							<div class="w-2 h-2 bg-green-400 rounded-full shrink-0"></div>
							Real-time fraud protection
						</li>
						<li class="flex items-center gap-2">
							<div class="w-2 h-2 bg-green-400 rounded-full shrink-0"></div>
							Instant payment processing
						</li>
						<li class="flex items-center gap-2">
							<div class="w-2 h-2 bg-green-400 rounded-full shrink-0"></div>
							24/7 customer support
						</li>
					</ul>
				</div>
				<div class="bg-white border border-card-border rounded-2xl p-6 shadow-card-custom">
					<h3 class="text-lg font-semibold text-foreground mb-4">
						Why Choose KleenSpotless?
					</h3>
					<ul class="space-y-3 text-sm text-muted-foreground">
						<li class="flex items-center gap-2">
							<div class="w-2 h-2 bg-green-400 rounded-full shrink-0"></div>
							Trusted Professionals
						</li>
						<li class="flex items-center gap-2">
							<div class="w-2 h-2 bg-green-400 rounded-full shrink-0"></div>
							On-Time, Every Time
						</li>
						<li class="flex items-center gap-2">
							<div class="w-2 h-2 bg-green-400 rounded-full shrink-0"></div>
							Spotless Clean Guaranteed
						</li>
						<li class="flex items-center gap-2">
							<div class="w-2 h-2 bg-green-400 rounded-full shrink-0"></div>
							Easy Booking & Updates
						</li>
					</ul>
				</div>
			</aside>
		</main>
		<!-- Security Features -->
		<section class="container mx-auto px-4 max-w-6xl mt-20 mb-14">
			<header class="text-center mb-8">
				<h2 class="text-2xl font-bold text-foreground mb-2">
					Your Security is Our Priority
				</h2>
				<p class="text-muted-foreground">
					Industry-leading protection for every transaction
				</p>
			</header>
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<!-- Feature Cards (same as before) -->
				<article class="bg-gradient-card border border-card-border rounded-2xl p-6 shadow-card-custom hover:shadow-hover transition-all duration-300 transform hover:scale-[1.02] animate-fade-in" style="animation-delay: 0ms">
					<div class="flex items-start gap-4">
						<div class="p-3 bg-primary/10 rounded-lg shrink-0">
							<svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
							</svg>
						</div>
						<div>
							<h3 class="font-semibold text-foreground mb-2">
								Bank-Level Security
							</h3>
							<p class="text-sm text-muted-foreground leading-relaxed">
								Your data is protected with the same encryption used by major banks worldwide.
							</p>
						</div>
					</div>
				</article>
				<article class="bg-gradient-card border border-card-border rounded-2xl p-6 shadow-card-custom hover:shadow-hover transition-all duration-300 transform hover:scale-[1.02] animate-fade-in" style="animation-delay: 100ms">
					<div class="flex items-start gap-4">
						<div class="p-3 bg-primary/10 rounded-lg shrink-0">
							<svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
							</svg>
						</div>
						<div>
							<h3 class="font-semibold text-foreground mb-2">
								PCI DSS Compliant
							</h3>
							<p class="text-sm text-muted-foreground leading-relaxed">
								Square meets the highest standards for payment card industry data security.
							</p>
						</div>
					</div>
				</article>
				<article class="bg-gradient-card border border-card-border rounded-2xl p-6 shadow-card-custom hover:shadow-hover transition-all duration-300 transform hover:scale-[1.02] animate-fade-in" style="animation-delay: 200ms">
					<div class="flex items-start gap-4">
						<div class="p-3 bg-primary/10 rounded-lg shrink-0">
							<svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
							</svg>
						</div>
						<div>
							<h3 class="font-semibold text-foreground mb-2">
								Fraud Protection
							</h3>
							<p class="text-sm text-muted-foreground leading-relaxed">
								Advanced machine learning algorithms monitor and prevent fraudulent transactions.
							</p>
						</div>
					</div>
				</article>
				<article class="bg-gradient-card border border-card-border rounded-2xl p-6 shadow-card-custom hover:shadow-hover transition-all duration-300 transform hover:scale-[1.02] animate-fade-in" style="animation-delay: 300ms">
					<div class="flex items-start gap-4">
						<div class="p-3 bg-primary/10 rounded-lg shrink-0">
							<svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
							</svg>
						</div>
						<div>
							<h3 class="font-semibold text-foreground mb-2">
								Instant Processing
							</h3>
							<p class="text-sm text-muted-foreground leading-relaxed">
								Payments are processed immediately with real-time verification and confirmation.
							</p>
						</div>
					</div>
				</article>
				<!-- ... keep your feature articles unchanged ... -->
			</div>
		</section>
		<footer>
			<div class="text-gray-500 text-center py-4">
				<p class="text-sm">© 2025 Glimmr. All rights reserved.</p>
				<p class="text-xs">Made with ❤️ by Divgm Technologies</p>
			</div>
		</footer>
		<script type="module" src="{{ url_for('static', filename='js/vendors/lottie/dotlottie-wc.js') }}"></script>
		<script
			type="text/javascript"
			src="{{ checkout_url }}"
			></script>
		<script>
			window.SQUARE_CONFIG = {
			  appId: "{{ square_app_id }}",
			  locationId: "{{ square_location_id }}"
			};
			
			const bookingDetails = { 
			  amount: "{{ booking_price }}",
			  billingContact: {
			    givenName: '{{ client.first_name }}',
			    familyName: '{{ client.last_name }}',
			    email: '{{ client.email }}',
			    phone: '{{ client.phone }}',
			    addressLines: ['{{ client.street }}'],
			    city: '{{ client.city }}',
			    state: '{{ client.state }}',
			    countryCode: 'CA',
			  },
			  currencyCode: 'CAD',
			  intent: 'CHARGE',
			  customerInitiated: true,
			  sellerKeyedIn: false,
			};
			
			document.getElementById("viewDetails").addEventListener("click", function () {
			  const clientDetailsBox = document.getElementById("clientDetailsBox");
			  const icon = document.getElementById("accordion-icon");
			  
			  clientDetailsBox.classList.toggle("hidden");
			  icon.classList.toggle("rotate-180");
			});
		</script>
		<script src="{{ url_for('static', filename='js/square-payments.js') }}"></script>
		<script src="{{ url_for('static', filename='js/toast-notification.js') }}"></script>
	</body>
</html>
